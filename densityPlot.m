function [] = densityPlot(foldername)
%densityPlot plots desnity from xy data
%   Detailed explanation goes here
%foldername = 'C:\Users\Jeremy\Desktop\0415_npr1_cont\20210415_142145';
disp(['Working on: ' foldername]);
fnames = dir([foldername '\*.dat']);
data = [];


edgex = linspace(0,30,100);
edgey = linspace(0,35,100);

if size(fnames,1)<2
    disp(['There are insufficient .dat files in folder: ' foldername])
elseif size(fnames,1)>2
    for i = 1:length(fnames)-1
        tempdata = readmatrix([foldername '\' fnames(i).name]);
        
        if size(tempdata, 2)>2
            data = vertcat(data, tempdata);
        end
    end
    
    
    oot = regexp(fnames(1).name, '\', 'split');
    oot = regexp(oot{end}, '\.', 'split');
    oot = oot{1};
    outname = [foldername '\' oot '_densityPlot'];
    
    
    
    figure('Position', [156.2000 169 1296 593]);
    
    subplot(1,2,1);
    hist3(data(:,end-1:end),'Edges', {edgex,edgey},'CDataMode','auto',...
        'FaceColor','interp', 'EdgeAlpha', 0.1);
    adjustfig(oot);
    view(2)
    
    subplot(1,2,2);
    
    hist3(data(:,end-1:end),'Edges', {edgex,edgey},'CDataMode','auto',...
        'FaceColor','interp', 'EdgeAlpha', 0.05);
    adjustfig(oot);
    zlim([0,200])
    zlabel('Occupancy (Worm-Seconds)')
     
    colorbar()
    
    exportgraphics(gcf, [outname '.jpg'], 'Resolution', 300)
    close(1)
end

    function []= adjustfig(oot)
        caxis([0,200])
        xlabel('X location (mm)');
        ylabel('Y location (mm)');
        title(oot, 'Interpreter', 'none')
        colormap([1,1,1;0.857142865657806,0.921008408069611,0.963025212287903;0.714285731315613,0.842016816139221,0.926050424575806;0.571428596973419,0.763025224208832,0.889075636863709;0.428571432828903,0.684033632278442,0.852100849151611;0.285714298486710,0.605042040348053,0.815126061439514;0.142857149243355,0.526050448417664,0.778151273727417;0,0.447058826684952,0.741176486015320;0.0247058831155300,0.433921575546265,0.731960773468018;0.0494117662310600,0.420784324407578,0.722745120525360;0.0741176456212997,0.407647073268890,0.713529407978058;0.0988235324621201,0.394509792327881,0.704313755035400;0.123529411852360,0.381372541189194,0.695098042488098;0.148235291242600,0.368235290050507,0.685882389545441;0.172941178083420,0.355098038911819,0.676666676998138;0.197647064924240,0.341960787773132,0.667451024055481;0.222352936863899,0.328823536634445,0.658235311508179;0.247058823704720,0.315686285495758,0.649019598960877;0.271764695644379,0.302549034357071,0.639803946018219;0.296470582485199,0.289411783218384,0.630588233470917;0.321176469326019,0.276274502277374,0.621372580528259;0.345882356166840,0.263137251138687,0.612156867980957;0.370588243007660,0.250000000000000,0.602941215038300;0.395294129848480,0.236862748861313,0.593725502490997;0.419999986886978,0.223725497722626,0.584509849548340;0.444705873727798,0.210588246583939,0.575294137001038;0.469411760568619,0.197450980544090,0.566078484058380;0.494117647409439,0.184313729405403,0.556862771511078;0.498985797166824,0.180662617087364,0.544016242027283;0.503853976726532,0.177011504769325,0.531169712543488;0.508722126483917,0.173360377550125,0.518323242664337;0.513590276241303,0.169709265232086,0.505476713180542;0.518458425998688,0.166058152914047,0.492630183696747;0.523326575756073,0.162407040596008,0.479783654212952;0.528194725513458,0.158755913376808,0.466937154531479;0.533062875270844,0.155104801058769,0.454090625047684;0.537931025028229,0.151453688740730,0.441244095563889;0.542799174785614,0.147802576422691,0.428397595882416;0.547667324542999,0.144151464104652,0.415551066398621;0.552535533905029,0.140500336885452,0.402704536914825;0.557403683662415,0.136849224567413,0.389858037233353;0.562271833419800,0.133198112249374,0.377011507749558;0.567139983177185,0.129546999931335,0.364164978265762;0.572008132934570,0.125895872712135,0.351318478584290;0.576876282691956,0.122244760394096,0.338471949100494;0.581744432449341,0.118593648076057,0.325625449419022;0.586612582206726,0.114942528307438,0.312778919935226;0.591480731964111,0.111291415989399,0.299932390451431;0.596348881721497,0.107640303671360,0.287085890769959;0.601217031478882,0.103989183902740,0.274239361286163;0.606085181236267,0.100338071584702,0.261392831802368;0.610953390598297,0.0966869518160820,0.248546317219734;0.615821540355682,0.0930358394980431,0.235699802637100;0.620689690113068,0.0893847197294235,0.222853288054466;0.625557839870453,0.0857336074113846,0.210006773471832;0.630425989627838,0.0820824876427651,0.197160243988037;0.635294139385223,0.0784313753247261,0.184313729405403;0.643977642059326,0.0863678827881813,0.183753505349159;0.652661085128784,0.0943043902516365,0.183193281292915;0.661344528198242,0.102240897715092,0.182633057236671;0.670028030872345,0.110177405178547,0.182072833180428;0.678711533546448,0.118113912642002,0.181512609124184;0.687394976615906,0.126050427556038,0.180952385067940;0.696078419685364,0.133986935019493,0.180392161011696;0.704761922359467,0.141923442482948,0.179831936955452;0.713445425033569,0.149859949946404,0.179271712899208;0.722128868103027,0.157796457409859,0.178711488842964;0.730812311172485,0.165732964873314,0.178151264786720;0.739495813846588,0.173669472336769,0.177591040730476;0.748179316520691,0.181605979800224,0.177030816674232;0.756862759590149,0.189542487263680,0.176470592617989;0.765546202659607,0.197478994727135,0.175910368561745;0.774229705333710,0.205415502190590,0.175350144505501;0.782913208007813,0.213352009654045,0.174789920449257;0.791596651077271,0.221288517117500,0.174229696393013;0.800280094146729,0.229225024580956,0.173669472336769;0.808963596820831,0.237161532044411,0.173109248280525;0.817647099494934,0.245098039507866,0.172549024224281;0.826330542564392,0.253034561872482,0.171988800168037;0.835013985633850,0.260971069335938,0.171428576111794;0.843697488307953,0.268907576799393,0.170868352055550;0.852380990982056,0.276844084262848,0.170308127999306;0.861064434051514,0.284780591726303,0.169747903943062;0.869747877120972,0.292717099189758,0.169187679886818;0.878431379795075,0.300653606653214,0.168627455830574;0.887114882469177,0.308590114116669,0.168067231774330;0.895798325538635,0.316526621580124,0.167507007718086;0.904481768608093,0.324463129043579,0.166946783661842;0.913165271282196,0.332399636507034,0.166386559605598;0.921848773956299,0.340336143970490,0.165826335549355;0.930532217025757,0.348272651433945,0.165266111493111;0.939215660095215,0.356209158897400,0.164705887436867;0.947899162769318,0.364145666360855,0.164145663380623;0.956582665443420,0.372082173824310,0.163585439324379;0.965266108512878,0.380018681287766,0.163025215268135;0.973949551582336,0.387955188751221,0.162464991211891;0.982633054256439,0.395891696214676,0.161904767155647;0.991316556930542,0.403828203678131,0.161344543099403;1,0.411764711141586,0.160784319043159;1,0.420955896377564,0.158272057771683;1,0.430147051811218,0.155759811401367;1,0.439338237047195,0.153247550129890;1,0.448529422283173,0.150735303759575;1,0.457720607519150,0.148223042488098;1,0.466911762952805,0.145710796117783;1,0.476102948188782,0.143198534846306;1,0.485294133424759,0.140686273574829;1,0.494485288858414,0.138174027204514;1,0.503676474094391,0.135661765933037;1,0.512867629528046,0.133149519562721;1,0.522058844566345,0.130637258291245;1,0.531250000000000,0.128124997019768;1,0.540441155433655,0.125612750649452;1,0.549632370471954,0.123100496828556;1,0.558823525905609,0.120588243007660;1,0.568014681339264,0.118075981736183;1,0.577205896377564,0.115563727915287;1,0.586397051811218,0.113051474094391;1,0.595588266849518,0.110539220273495;1,0.604779422283173,0.108026966452599;1,0.613970577716827,0.105514712631702;1,0.623161792755127,0.103002451360226;1,0.632352948188782,0.100490197539330;1,0.641544103622437,0.0979779437184334;1,0.650735318660736,0.0954656898975372;1,0.659926474094391,0.0929534360766411;1,0.669117629528046,0.0904411822557449;1,0.678308844566345,0.0879289209842682;1,0.687500000000000,0.0854166671633720;1,0.696691155433655,0.0829044133424759;1,0.705882370471954,0.0803921595215797;1,0.715073525905609,0.0778799057006836;1,0.724264681339264,0.0753676518797875;1,0.733455896377564,0.0728553980588913;1,0.742647051811218,0.0703431367874146;1,0.751838266849518,0.0678308829665184;1,0.761029422283173,0.0653186291456223;1,0.770220577716827,0.0628063753247261;1,0.779411792755127,0.0602941215038300;1,0.788602948188782,0.0577818639576435;1,0.797794103622437,0.0552696101367474;1,0.806985318660736,0.0527573563158512;1,0.816176474094391,0.0502450987696648;1,0.825367629528046,0.0477328449487686;1,0.834558844566345,0.0452205911278725;1,0.843750000000000,0.0427083335816860;1,0.852941155433655,0.0401960797607899;1,0.862132370471954,0.0376838259398937;1,0.871323525905609,0.0351715683937073;1,0.880514681339264,0.0326593145728111;1,0.889705896377564,0.0301470607519150;1,0.898897051811218,0.0276348050683737;1,0.908088207244873,0.0251225493848324;1,0.917279422283173,0.0226102955639362;1,0.926470577716827,0.0200980398803949;1,0.935661792755127,0.0175857841968536;1,0.944852948188782,0.0150735303759575;1,0.954044103622437,0.0125612746924162;1,0.963235318660736,0.0100490199401975;1,0.972426474094391,0.00753676518797874;1,0.981617629528046,0.00502450997009873;1,0.990808844566345,0.00251225498504937;1,1,0;1,1,0.0107526881620288;1,1,0.0215053763240576;1,1,0.0322580635547638;1,1,0.0430107526481152;1,1,0.0537634417414665;1,1,0.0645161271095276;1,1,0.0752688199281693;1,1,0.0860215052962303;1,1,0.0967741906642914;1,1,0.107526883482933;1,1,0.118279568850994;1,1,0.129032254219055;1,1,0.139784947037697;1,1,0.150537639856339;1,1,0.161290317773819;1,1,0.172043010592461;1,1,0.182795703411102;1,1,0.193548381328583;1,1,0.204301074147224;1,1,0.215053766965866;1,1,0.225806444883347;1,1,0.236559137701988;1,1,0.247311830520630;1,1,0.258064508438110;1,1,0.268817216157913;1,1,0.279569894075394;1,1,0.290322571992874;1,1,0.301075279712677;1,1,0.311827957630157;1,1,0.322580635547638;1,1,0.333333343267441;1,1,0.344086021184921;1,1,0.354838699102402;1,1,0.365591406822205;1,1,0.376344084739685;1,1,0.387096762657166;1,1,0.397849470376968;1,1,0.408602148294449;1,1,0.419354826211929;1,1,0.430107533931732;1,1,0.440860211849213;1,1,0.451612889766693;1,1,0.462365597486496;1,1,0.473118275403976;1,1,0.483870953321457;1,1,0.494623661041260;1,1,0.505376338958740;1,1,0.516129016876221;1,1,0.526881694793701;1,1,0.537634432315826;1,1,0.548387110233307;1,1,0.559139788150787;1,1,0.569892466068268;1,1,0.580645143985748;1,1,0.591397821903229;1,1,0.602150559425354;1,1,0.612903237342835;1,1,0.623655915260315;1,1,0.634408593177795;1,1,0.645161271095276;1,1,0.655913949012756;1,1,0.666666686534882;1,1,0.677419364452362;1,1,0.688172042369843;1,1,0.698924720287323;1,1,0.709677398204804;1,1,0.720430135726929;1,1,0.731182813644409;1,1,0.741935491561890;1,1,0.752688169479370;1,1,0.763440847396851;1,1,0.774193525314331;1,1,0.784946262836456;1,1,0.795698940753937;1,1,0.806451618671417;1,1,0.817204296588898;1,1,0.827956974506378;1,1,0.838709652423859;1,1,0.849462389945984;1,1,0.860215067863464;1,1,0.870967745780945;1,1,0.881720423698425;1,1,0.892473101615906;1,1,0.903225779533386;1,1,0.913978517055512;1,1,0.924731194972992;1,1,0.935483872890472;1,1,0.946236550807953;1,1,0.956989228725433;1,1,0.967741906642914;1,1,0.978494644165039;1,1,0.989247322082520;1,1,1]);
    end

end

